---
template: post
title: "Laravel Statsã‚’ä½¿ã£ãŸã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã®åˆ†æ"
slug: /posts/analyze-code-with-laravelstats
draft: false
date: 2019-10-06T15:23:00.000+09:00
description: "Laravelãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰åˆ†æãƒ©ã‚¤ãƒ–ãƒ©ãƒªã€‚"
category: Dev
tags:
  - PHP
  - Laravel
socialImage: "/icon.png"
---

2019å¹´9æœˆ1æ—¥ã«v2.0ãŒãƒªãƒªãƒ¼ã‚¹ã•ã‚Œã¾ã—ãŸğŸ‰

ç§ã¯v2.0ã«ãªã£ã¦ã‹ã‚‰ã“ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®å­˜åœ¨ã‚’çŸ¥ã£ãŸã®ã§ã€å†™çµŒç”¨ã«ä½œæˆã—ã¦ã„ãŸLaravelãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®æ›´æ–°ã‚’å…¼ã­ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ã¿ã¾ã—ãŸã€‚

## ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¡ä»¶

v2.0ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã¯æ¬¡ã®æ¡ä»¶ã‚’æº€ãŸã—ã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

* PHP 7.2ä»¥ä¸Š
* Laravel v5.8ä»¥ä¸Šã‚‚ã—ãã¯Lumen v5.8ä»¥ä¸Š

Lumenã§ã‚‚ä½¿ç”¨å¯èƒ½ã¨ã®ã“ã¨ã§ã™ãŒã€ä»Šå›ã¯Laravelãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã®ä½¿ç”¨æ–¹æ³•ã‚’è¨˜è¿°ã—ã¾ã™ã€‚

## ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§ãã¾ã™ã€‚

```sh
$ composer require "wnx/laravel-stats" --dev
```

ã‚µãƒ¼ãƒ“ã‚¹ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã®è¨­å®šã¯è‡ªå‹•ã§è¡Œã‚ã‚Œã¾ã™ãŒã€æ‰‹å‹•ã§è¡Œã†å ´åˆã¯`config/app.php`ã«æ¬¡ã®ã‚³ãƒ¼ãƒ‰ã‚’è¿½åŠ ã§ãã¾ã™ã€‚

```php
'providers' => [
    // ...
    \Wnx\LaravelStats\StatsServiceProvider::class,
]
```

åˆ¥é€”ã‚³ãƒ³ãƒ•ã‚£ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã™ã‚‹å ´åˆã¯ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã§ä½œæˆã•ã‚Œã¾ã™ã€‚

```sh
$ php artisan vendor:publish --provider="Wnx\LaravelStats\StatsServiceProvider"
```

å®Ÿè¡ŒãŒå®Œäº†ã™ã‚‹ã¨ä»¥ä¸‹ã®ã‚ˆã†ãªãƒ•ã‚¡ã‚¤ãƒ«ãŒ`config/stats.php`ã¨ã—ã¦ä½œæˆã•ã‚Œã¾ã™ã€‚ï¼ˆä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã¯ã‚³ãƒ¡ãƒ³ãƒˆã‚’æ›¸ãæ›ãˆã¦ã„ã¾ã™ã€‚ï¼‰

```php
<?php

return [

    /*
     * å‡ºåŠ›å¯¾è±¡ã®ãƒ‘ã‚¹
     */
    'paths' => [
        base_path('app'),
        base_path('database'),
        base_path('tests'),
    ],

    /*
     * å‡ºåŠ›å¯¾è±¡å¤–ã¨ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ãƒ»ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
     */
    'exclude' => [
        base_path('tests/bootstrap.php'),
        // base_path('app/helpers.php'),
        // base_path('app/Services'),
    ],

    /*
     * ç‹¬è‡ªã§å‡ºåŠ›å¯¾è±¡ã‚’å¢—ã‚„ã™å ´åˆã¯ã“ã“ã«è¿½åŠ ã™ã‚‹ã€‚å¾Œè¿°ã€‚
     */
    'custom_component_classifier' => [
        // \App\Classifiers\CustomerExportClassifier::class
    ],

    /*
     * å¯¾è±¡å¤–ã¨ã™ã‚‹ãƒ«ãƒ¼ãƒ«ã€‚
     * ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯vendorãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä»¥ä¸‹ã¨ã‚³ã‚¢ã‚¯ãƒ©ã‚¹ãŒå¯¾è±¡å¤–ã¨ãªã£ã¦ã„ã‚‹ã€‚
     *
     * ä»¥ä¸‹ã®2ãƒ•ã‚¡ã‚¤ãƒ«ãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ç”¨æ„ã•ã‚Œã¦ã„ã‚‹ã€‚
     * - \Wnx\LaravelStats\RejectionStrategies\RejectVendorClasses::class
     * - \Wnx\LaravelStats\RejectionStrategies\RejectInternalClasses::class
     *
     * ä¸Šè¨˜ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ«ãƒ¼ãƒ«ä»¥å¤–ã«ã—ãŸã„å ´åˆã¯ã€`Wnx\LaravelStats\Contracts\RejectionStrategy`ã‚’å®Ÿè£…ã—ãŸã‚¯ãƒ©ã‚¹ã‚’åˆ¥é€”ä½œæˆã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚
     */
    'rejection_strategy' => \Wnx\LaravelStats\RejectionStrategies\RejectVendorClasses::class,

    /*
     * å¯¾è±¡å¤–ã¨ã™ã‚‹åå‰ç©ºé–“ã€‚
     * `Str::startsWith()`ã§å¯¾è±¡å¤–ã‹ã‚’åˆ¤åˆ¥ã—ã¦ã„ã‚‹ã€‚
     *
     * `Illuminate`ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã§Illuminateå…¨ä½“ã‚’å¯¾è±¡å¤–ã«å‡ºæ¥ã‚‹ã€‚
     * ã¾ãŸ`Illuminate\Support`ã®ã‚ˆã†ã«ä¸€éƒ¨ã‚’å¯¾è±¡å¤–ã«ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã€‚
     */
    'ignored_namespaces' => [
        'Wnx\LaravelStats',
        'Illuminate',
        'Symfony',
    ],

];
```

## ä½¿ã„æ–¹

`artisan`ã‚³ãƒãƒ³ãƒ‰ã§å®Ÿè¡Œã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

```sh
$ php artisan stats
```

ä»¥ä¸‹ã®ç”»åƒã®ã‚ˆã†ãªå‡ºåŠ›çµæœã«ãªã‚Šã¾ã™ã€‚

ç”»åƒå…¥ã‚Œã‚‹

### ã‚ªãƒ—ã‚·ãƒ§ãƒ³

| ã‚ªãƒ—ã‚·ãƒ§ãƒ³ | èª¬æ˜ |
| -- | -- |
| --json | jsonå½¢å¼ã§å‡ºåŠ› |
| --components[=COMPONENTS] | å‡ºåŠ›å¯¾è±¡ã‚’æŒ‡å®šã—ã¦å‡ºåŠ› |
| -h, --help | ãƒ˜ãƒ«ãƒ—ã®è¡¨ç¤º |
| -q, --quiet | çµæœã‚’å‡ºåŠ›ã—ãªã„ |
| -V, --version | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®è¡¨ç¤º |
| --ansi | ANSIã§å‡ºåŠ› |
| --no-ansi | ANSIã§å‡ºåŠ›ã—ãªã„ |
| -n, --no-interaction | å¯¾è©±å½¢å¼ã«ã—ãªã„ |
| --env[=ENV] | å®Ÿè¡Œç’°å¢ƒã‚’æŒ‡å®šã—ã¦å‡ºåŠ› |
| -v, -vv, -vvv, --verbose | å‡ºåŠ›ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è©³ç´°ã«ã™ã‚‹ã€‚ |

`-v, -vv, -vvv,`ã‚’å®Ÿè¡Œã—ã¦ã¿ã¾ã—ãŸãŒã€ç§ãŒå®Ÿè¡Œã—ãŸç’°å¢ƒã§ã¯å‡ºåŠ›çµæœãŒå¤‰ã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸğŸ˜¢

## å‡ºåŠ›ã®åˆ†é¡æ–¹æ³•

Laravel Statsã§ã¯ä»¥ä¸‹ã®æ¡ä»¶ã§åˆ†é¡ã—ã¦ã„ã¾ã™ã€‚

| ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ | æ¡ä»¶ |
|:--|:--|
| Controller | ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã«ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹ã€‚`php artisan route:list`ã«è¡¨ç¤ºã•ã‚Œã‚‹ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ© |
| Model | `Illuminate\Database\Eloquent\Model`ãŒç¶™æ‰¿ã•ã‚Œã¦ã„ã‚‹ãƒ•ã‚¡ã‚¤ãƒ« |
| Command | `Illuminate\Console\Command`ãŒç¶™æ‰¿ã•ã‚Œã¦ã„ã‚‹ãƒ•ã‚¡ã‚¤ãƒ« |
| Rule | `Illuminate\Contracts\Validation\Rule`ãŒç¶™æ‰¿ã•ã‚Œã¦ã„ã‚‹ãƒ•ã‚¡ã‚¤ãƒ« |
| Policy | `AuthServiceProvider`ã«ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹ãƒãƒªã‚·ãƒ¼ |
| Middleware | `App\Http\Kernel`ã«ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ |
| Event | `Illuminate\Foundation\Events\Dispatchable`ãƒˆãƒ¬ã‚¤ãƒˆã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ãƒ•ã‚¡ã‚¤ãƒ« |
| Event Listener | `EventServiceProvider`ã«ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹ãƒ•ã‚¡ã‚¤ãƒ« |
| Mail | `Illuminate\Mail\Mailable`ãŒç¶™æ‰¿ã•ã‚Œã¦ã„ã‚‹ãƒ•ã‚¡ã‚¤ãƒ« |
| Notification | `Illuminate\Notifications\Notification`ãŒç¶™æ‰¿ã•ã‚Œã¦ã„ã‚‹ãƒ•ã‚¡ã‚¤ãƒ« |
| Nova Action | `Laravel\Nova\Actions\Action`ãŒç¶™æ‰¿ã•ã‚Œã¦ã„ã‚‹ãƒ•ã‚¡ã‚¤ãƒ« |
| Nova Filter | `Laravel\Nova\Filters\Filter`ãŒç¶™æ‰¿ã•ã‚Œã¦ã„ã‚‹ãƒ•ã‚¡ã‚¤ãƒ« |
| Nova Lens | `Laravel\Nova\Lenses\Lens`ãŒç¶™æ‰¿ã•ã‚Œã¦ã„ã‚‹ãƒ•ã‚¡ã‚¤ãƒ« |
| Nova Resource | `Laravel\Nova\Resource`ãŒç¶™æ‰¿ã•ã‚Œã¦ã„ã‚‹ãƒ•ã‚¡ã‚¤ãƒ« |
| Job | `Illuminate\Foundation\Bus\Dispatchable`ãƒˆãƒ¬ã‚¤ãƒˆã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ãƒ•ã‚¡ã‚¤ãƒ« |
| Migration | `Illuminate\Database\Migrations\Migration`ãŒç¶™æ‰¿ã•ã‚Œã¦ã„ã‚‹ãƒ•ã‚¡ã‚¤ãƒ« |
| Request | `Illuminate\Foundation\Http\FormRequest`ãŒç¶™æ‰¿ã•ã‚Œã¦ã„ã‚‹ãƒ•ã‚¡ã‚¤ãƒ« |
| Resource | `Illuminate\Http\Resources\Json\Resource`, `Illuminate\Http\Resources\Json\JsonResource`ã¾ãŸã¯`Illuminate\Http\Resources\Json\ResourceCollection`ãŒç¶™æ‰¿ã•ã‚Œã¦ã„ã‚‹ãƒ•ã‚¡ã‚¤ãƒ« |
| Seeder | `Illuminate\Database\Seeder`ãŒç¶™æ‰¿ã•ã‚Œã¦ã„ã‚‹ãƒ•ã‚¡ã‚¤ãƒ« |
| ServiceProvider | `Illuminate\Support\ServiceProvider`ãŒç¶™æ‰¿ã•ã‚Œã¦ã„ã‚‹ãƒ•ã‚¡ã‚¤ãƒ« |
| Dusk Tests | `Laravel\Dusk\TestCase`ãŒç¶™æ‰¿ã•ã‚Œã¦ã„ã‚‹ãƒ•ã‚¡ã‚¤ãƒ« |
| BrowserKit Test | `Laravel\BrowserKitTesting\TestCase`ãŒç¶™æ‰¿ã•ã‚Œã¦ã„ã‚‹ãƒ•ã‚¡ã‚¤ãƒ« |
| PHPUnit Test | `PHPUnit\Framework\TestCase`ãŒç¶™æ‰¿ã•ã‚Œã¦ã„ã‚‹ãƒ•ã‚¡ã‚¤ãƒ« |

## å‡ºåŠ›åˆ†é¡ã®è¿½åŠ 

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¯ã«ä½œæˆã—ã¦ã„ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’åˆ†æå¯¾è±¡ã«ã™ã‚‹å ´åˆã¯ã€`Wnx\LaravelStats\Contracts\Classifier`ã‚’å®Ÿè£…ã—ãŸã‚¯ãƒ©ã‚¹ã‚’ä½œæˆã™ã‚‹ã“ã¨ã§è¿½åŠ ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ä¾‹ã¨ã—ã¦`app/Classifiers/RepositoryClassifier.php`ã‚’ä½œæˆã™ã‚‹ã¨ä»¥ä¸‹ã®ã‚ˆã†ãªãƒ•ã‚¡ã‚¤ãƒ«ã«ãªã‚Šã¾ã™ã€‚

```php
<?php

namespace App\Classifiers;

use Wnx\LaravelStats\ReflectionClass;
use Wnx\LaravelStats\Contracts\Classifier;

class RepositoryClassifier implements Classifier
{
    /**
     * å‡ºåŠ›æ™‚ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå
     */
    public function name(): string
    {
        $d = new DateTime();
        return 'Repositories';
    }

    /**
     * å‡ºåŠ›å¯¾è±¡ã¨ã™ã‚‹æ¡ä»¶
     */
    public function satisfies(ReflectionClass $class): bool
    {
        return $class->isSubclassOf(\App\Repositories\BaseRepository::class);
    }

    /**
     * Code LLoCã«è¡Œæ•°ã‚’å«ã‚ã‚‹ã‹
     */
    public function countsTowardsApplicationCode(): bool
    {
        return true;
    }

    /**
     * Test LLoCã«è¡Œæ•°ã‚’å«ã‚ã‚‹ã‹
     */
    public function countsTowardsTests(): bool
    {
        return true;
    }
}
```

ä½œæˆã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’`config/stats.php`ã®`custom_component_classifier`ã«è¿½åŠ ã™ã‚‹ã“ã¨ã§å‡ºåŠ›å¯¾è±¡ãŒè¿½åŠ ã•ã‚Œã¾ã™ã€‚

```php
<?php
    ...
    'custom_component_classifier' => [
        \App\Classifiers\RepositoryClassifier::class
    ],
    ...
```

## ã‚ã¨ãŒã

ã“ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã“ã¨ã§ãƒ•ã‚¡ã‚¤ãƒ«ã”ã¨ã®è¡Œæ•°ã‚„ãƒ¡ã‚½ãƒƒãƒ‰æ•°ã€ã‚¯ãƒ©ã‚¹æ•°ã‚’åˆ†æã™ã‚‹ã“ã¨ã§ã©ã“ãŒè¤‡é›‘ã«ãªã£ã¦ã„ã‚‹ã‹ã‚’æ‰‹è»½ã«èª¿ã¹ã‚‹ã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ã¨æ€ã„ã¾ã™ã€‚

Laravel Statsã¨[PHP Insights](https://phpinsights.com)ã‚’ä½µã›ã¦åˆ©ç”¨ã™ã‚‹ã“ã¨ã§ã‚ˆã‚Šãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ã‚³ãƒ¼ãƒ‰åˆ†æãŒæ—ã‚‹ã¨æ€ã†ã®ã§ä¸€åº¦ä½¿ç”¨ã—ã¦ã¿ã¦ã¯ã„ã‹ãŒã§ã—ã‚‡ã†ã‹ã€‚

## å‚è€ƒ

* [stefanzweifel/laravel-stats](https://github.com/stefanzweifel/laravel-stats)
* [Release v2.0.0 Â· stefanzweifel/laravel-stats](https://github.com/stefanzweifel/laravel-stats/releases/tag/v2.0.0)
  * è¿½åŠ æ©Ÿèƒ½ã‚„v1ã‹ã‚‰ã®ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆæ‰‹é †ã«ã¤ã„ã¦æ›¸ã‹ã‚Œã¦ã„ã¾ã™
* [Laravel Stats 2.0 is Here - Laravel News](https://laravel-news.com/laravel-stats-2-0)